<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Radiance Stealth Pro</title>
    <style>
        :root { --bg: #000; --accent: #32D74B; --card: #121214; --text: #fff; }
        body { font-family: -apple-system, system-ui; background: var(--bg); color: var(--text); margin: 0; }
        
        /* 拟态导航栏 */
        .header { display: flex; align-items: center; padding: 50px 20px 15px; background: rgba(18,18,20,0.8); backdrop-filter: saturate(180%) blur(20px); sticky; top: 0; z-index: 10; border-bottom: 0.5px solid #222; }
        .back-btn { font-size: 24px; color: var(--accent); cursor: pointer; display: none; margin-right: 15px; }
        .title { font-size: 18px; font-weight: 700; }

        .content { padding: 20px; transition: 0.3s; }
        .page { display: none; }
        .active { display: block; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* 应用列表美化 */
        .app-item { background: var(--card); border-radius: 16px; padding: 16px; margin-bottom: 12px; display: flex; align-items: center; border: 1px solid #222; }
        .app-icon { width: 44px; height: 44px; background: linear-gradient(135deg, #222, #333); border-radius: 10px; margin-right: 15px; }
        .app-name { font-size: 16px; font-weight: 600; margin-bottom: 2px; }
        .app-pkg { font-size: 11px; color: #888; }
        
        /* 编辑器 */
        #editor { width: 100%; height: 450px; background: #080808; color: #00FF41; border: 1px solid #333; border-radius: 12px; padding: 15px; font-family: 'SF Mono', monospace; font-size: 12px; }
        .btn { background: var(--accent); color: #000; border: none; width: 100%; padding: 18px; border-radius: 14px; font-weight: 700; font-size: 16px; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <div id="backBtn" class="back-btn" onclick="showMain()">‹</div>
        <div id="headerTitle" class="title">隐匿中心</div>
    </div>

    <div class="content">
        <div id="mainPage" class="page active">
            <div style="background: #1c1c1e; padding: 12px; border-radius: 10px; font-size: 11px; color: #32D74B; margin-bottom: 20px;">
                内核引擎: SUSFS-Hybrid V12 已就绪
            </div>
            <div id="appList">正在扫描应用...</div>
            <button class="btn" onclick="syncList()">同步全局隐藏</button>
        </div>

        <div id="detailPage" class="page">
            <div id="targetApp" style="margin-bottom: 15px; color: var(--accent); font-weight: bold;"></div>
            <textarea id="editor" spellcheck="false"></textarea>
            <button class="btn" onclick="saveApp()">保存个性化配置</button>
        </div>
    </div>

    <script>
        const CONF_PATH = "/data/adb/modules/stealth_hide";
        let selected = new Set();
        let currentPkg = "";

        async function exec(cmd) {
            try { return await (window.folk ? window.folk.exec(cmd) : window.ksu.exec(cmd)); } 
            catch(e) { return { stdout: "" }; }
        }

        async function init() {
            const pkgs = (await exec("pm list packages -3 | cut -d: -f2")).stdout.trim().split('\n').sort();
            const saved = (await exec(`cat ${CONF_PATH}/denylist.conf`)).stdout.trim().split('\n');
            saved.forEach(p => p && selected.add(p.trim()));

            document.getElementById('appList').innerHTML = pkgs.map(p => `
                <div class="app-item" onclick="showDetail('${p}')">
                    <div class="app-icon"></div>
                    <div style="flex:1">
                        <div class="app-name">${p.split('.').pop()}</div>
                        <div class="app-pkg">${p}</div>
                    </div>
                    <input type="checkbox" ${selected.has(p)?'checked':''} onclick="event.stopPropagation(); toggle('${p}')">
                </div>
            `).join('');
        }

        function toggle(p) { selected.has(p) ? selected.delete(p) : selected.add(p); }

        function showDetail(pkg) {
            currentPkg = pkg;
            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('detailPage').classList.add('active');
            document.getElementById('backBtn').style.display = "block";
            document.getElementById('headerTitle').innerText = "高级欺骗策略";
            document.getElementById('targetApp').innerText = pkg;
            
            loadAppConfig(pkg);
        }

        async function loadAppConfig(pkg) {
            const res = await exec(`cat ${CONF_PATH}/configs/${pkg}.json`);
            const template = {
                "hide_method": "susfs_clone",
                "spoof_fingerprint": "SAMSUNG-S24-ULTRA",
                "mask_paths": ["/data/dab/ap", "/proc/net/unix"]
            };
            document.getElementById('editor').value = res.stdout.trim() || JSON.stringify(template, null, 4);
        }

        function showMain() {
            document.getElementById('detailPage').classList.remove('active');
            document.getElementById('mainPage').classList.add('active');
            document.getElementById('backBtn').style.display = "none";
            document.getElementById('headerTitle').innerText = "隐匿中心";
        }

        async function syncList() {
            await exec(`echo -e "${Array.from(selected).join('\\n')}" > ${CONF_PATH}/denylist.conf`);
            alert("全局策略已同步到内核层");
        }

        async function saveApp() {
            await exec(`mkdir -p ${CONF_PATH}/configs`);
            await exec(`echo '${document.getElementById('editor').value}' > ${CONF_PATH}/configs/${currentPkg}.json`);
            alert("应用配置已更新");
            showMain();
        }

        window.onload = init;
    </script>
</body>
</html>

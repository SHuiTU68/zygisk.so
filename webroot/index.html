<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Deceiver Ultra Final</title>
    <style>
        :root { --accent: #ff3b30; --bg: #050505; --card: #151517; --text: #efefef; }
        body { margin:0; background:var(--bg); color:var(--text); font-family:sans-serif; }
        .nav { position:fixed; bottom:0; width:100%; height:70px; background:#111; display:flex; border-top:1px solid #222; }
        .nav-item { flex:1; text-align:center; padding-top:12px; color:#666; font-size:12px; }
        .nav-item.active { color:var(--accent); }
        .page { display:none; padding:60px 20px 100px; height:100vh; overflow-y:auto; box-sizing:border-box; }
        .page.active { display:block; }
        .card { background:var(--card); border-radius:12px; padding:15px; margin-bottom:12px; border:1px solid #222; }
        .btn { background:var(--accent); color:#fff; border:none; padding:15px; border-radius:10px; width:100%; font-weight:bold; }
        textarea { width:100%; background:#000; color:#0f0; border:1px solid #333; border-radius:8px; padding:10px; font-family:monospace; }
    </style>
</head>
<body>
    <div id="p1" class="page active">
        <h2>内核应用控制</h2>
        <input type="text" id="q" placeholder="搜索包名..." style="width:100%;padding:10px;margin-bottom:15px;border-radius:8px;background:#222;border:none;color:#fff" oninput="render()">
        <div id="list">加载中...</div>
    </div>

    <div id="p2" class="page">
        <h2>SUSFS 自定义路径</h2>
        <div class="card">
            <p style="font-size:12px;color:#888">每行一个路径，这些路径将对勾选的应用完全不可见。</p>
            <textarea id="paths" rows="10"></textarea>
            <button class="btn" style="margin-top:10px" onclick="savePaths()">保存并注入内核</button>
        </div>
    </div>

    <div id="p3" class="page">
        <h2>审计与关于</h2>
        <div class="card">
            <b>内核版本:</b> Radiance V15.0<br>
            <b>协议:</b> Zygisk NoHello + SUSFS<br>
            <b>状态:</b> <span style="color:#32d74b">内核联动已就绪</span>
        </div>
        <button class="btn" onclick="run('sh /data/adb/modules/stealth_hide/service.sh').then(()=>location.reload())">强制重载数据库</button>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="tab(1)">应用</div>
        <div class="nav-item" onclick="tab(2)">路径</div>
        <div class="nav-item" onclick="tab(3)">审计</div>
    </div>

    <script>
        let apps=[], selected=new Set();
        async function run(c){ try{ return await (window.folk||window.ksu).exec(c); }catch(e){ return {stdout:""}; } }

        function tab(n){
            document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));
            document.getElementById('p'+n).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        async function init(){
            const res = await run("cat /data/local/tmp/deceiver_apps.json");
            if(res.stdout){
                apps = JSON.parse(res.stdout).map(a=>a.pkg);
                const conf = await run("cat /data/adb/modules/stealth_hide/denylist.conf");
                conf.stdout.split('\n').forEach(p=>p.trim()&&selected.add(p.trim()));
                const pConf = await run("cat /data/adb/modules/stealth_hide/custom_paths.conf");
                document.getElementById('paths').value = pConf.stdout;
                render();
            }
        }

        function render(){
            const key = document.getElementById('q').value.toLowerCase();
            document.getElementById('list').innerHTML = apps.filter(p=>p.includes(key)).map(p=>`
                <div class="card" style="display:flex;align-items:center">
                    <div style="flex:1;font-size:14px">${p}</div>
                    <input type="checkbox" ${selected.has(p)?'checked':''} onclick="toggle('${p}')">
                </div>
            `).join('');
        }

        function toggle(p){ selected.has(p)?selected.delete(p):selected.add(p); saveList(); }
        async function saveList(){ await run(`echo -e "${Array.from(selected).join('\\n')}" > /data/adb/modules/stealth_hide/denylist.conf`); }
        async function savePaths(){ await run(`echo "${document.getElementById('paths').value}" > /data/adb/modules/stealth_hide/custom_paths.conf`); alert("路径配置已同步"); }

        window.onload = init;
    </script>
</body>
</html>
